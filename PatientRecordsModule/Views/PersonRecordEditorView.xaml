<UserControl x:Class="PatientRecordsModule.Views.PersonRecordEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:toolkit="http://schemas.xceed.com/wpf/xaml/toolkit"
             xmlns:converters="clr-namespace:Core.Wpf.Converters;assembly=Core.Wpf"
             xmlns:viewModels="clr-namespace:PatientRecordsModule.ViewModels"
             xmlns:views="clr-namespace:PatientRecordsModule.Views"
             mc:Ignorable="d"
             d:DesignHeight="200" d:DesignWidth="500" Height="Auto">
    <UserControl.Resources>
        <DataTemplate x:Key="BrigadeItemTemplate">
            <StackPanel>
                <Image Source="pack://application:,,,/Core;Component/Resources/Images/Man48x48.png" Height="48" Width="48"/>
                <TextBlock Text="{Binding RoleName}" TextAlignment="Center"/>
                <TextBlock Text="{Binding StaffName}" TextAlignment="Center"/>
                <TextBlock Text="{Binding PersonName}" FontWeight="Bold" TextAlignment="Center"/>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="SelectedBrigadeItemTemplate">
            <StackPanel>
                <Button Command="{Binding RemoveRecordMemberCommand}" ToolTip="Удалить из бригады" Visibility="{Binding IsPersonMember, Converter={x:Static converters:BoolToVisibilityConverter.Instance}}">
                    <Button.Template>
                        <ControlTemplate>
                            <Image Source="pack://application:,,,/Core;Component/Resources/Images/Remove.png" Height="16" Width="16" HorizontalAlignment="Right"/>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
                <Image Source="pack://application:,,,/Core;Component/Resources/Images/Man48x48.png" Height="48" Width="48"/>
                <TextBlock Text="{Binding RoleName}" TextAlignment="Center"/>
                <ComboBox ItemsSource="{Binding PersonStaffs}" DisplayMemberPath="Name" SelectedValuePath="Id" SelectedValue="{Binding PersonStaffId}"/>
            </StackPanel>
        </DataTemplate>

        <Style TargetType="{x:Type ListBoxItem}" x:Key="ContainerStyle">
            <Setter Property="ContentTemplate" Value="{StaticResource BrigadeItemTemplate}" />
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="ContentTemplate" Value="{StaticResource SelectedBrigadeItemTemplate}" />
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0"
              Visibility="{Binding IsEditModeInCurrentProtocolEditor, Converter={x:Static converters:BoolToVisibilityConverter.Instance}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="4" Text="{Binding RecordTypeName}" FontWeight="Bold" FontSize="20" TextAlignment="Center" HorizontalAlignment="Stretch"/>
            <ListBox Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="4" ItemContainerStyle="{StaticResource ContainerStyle}" ScrollViewer.HorizontalScrollBarVisibility="Disabled" BorderBrush="Black" Margin="2,0,2,2"
                        ItemsSource="{Binding Brigade}">
                <ListBox.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel IsItemsHost="True" />
                    </ItemsPanelTemplate>
                </ListBox.ItemsPanel>
            </ListBox>
            <TextBlock Grid.Row="2" Grid.Column="0" Text="Случай:" Margin="2" HorizontalAlignment="Left" VerticalAlignment="Center" Visibility="{Binding IsVisibleVisits, Converter={x:Static converters:BoolToVisibilityConverter.Instance}}"/>
            <ComboBox Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="3" HorizontalAlignment="Stretch" Visibility="{Binding IsVisibleVisits, Converter={x:Static converters:BoolToVisibilityConverter.Instance}}"
                      SelectedValuePath="Id" DisplayMemberPath="Name"  
                      ItemsSource="{Binding ParentVisits}" 
                      SelectedValue="{Binding ParentVisitId}"/>
            <TextBlock Grid.Row="3" Grid.Column="0" Text="Кабинет:" Margin="2" HorizontalAlignment="Left" VerticalAlignment="Center" Visibility="{Binding IsVisibleRooms, Converter={x:Static converters:BoolToVisibilityConverter.Instance}}"/>
            <ComboBox Grid.Row="3" Grid.Column="1" HorizontalAlignment="Stretch" Visibility="{Binding IsVisibleRooms, Converter={x:Static converters:BoolToVisibilityConverter.Instance}}"
                      SelectedValuePath="Id" DisplayMemberPath="Name"  
                      ItemsSource="{Binding Rooms}" 
                      SelectedValue="{Binding RoomId}"/>
            <TextBlock Grid.Row="4" Grid.Column="0" Text="Период оказания" Margin="2" HorizontalAlignment="Left" VerticalAlignment="Center"/>
            <ComboBox Grid.Row="4" Grid.Column="1" HorizontalAlignment="Stretch"
                      SelectedValuePath="Id" DisplayMemberPath="Name"  
                      ItemsSource="{Binding RecordPeriods}" 
                      SelectedValue="{Binding SelectedPeriodId}"/>

            <TextBlock Grid.Row="5" Grid.Column="0" Text="Форма оказания" VerticalAlignment="Center" Margin="2" HorizontalAlignment="Left"/>
            <ComboBox Grid.Row="5" Grid.Column="1" HorizontalAlignment="Stretch"
                      SelectedValuePath="Id" DisplayMemberPath="Name" 
                      ItemsSource="{Binding Urgentlies}" 
                      SelectedValue="{Binding SelectedUrgentlyId}"/>

            <TextBlock Grid.Row="4" Grid.Column="2" Text="Время начала услуги" VerticalAlignment="Center" Margin="2,4,2,3"/>
            <toolkit:DateTimePicker Grid.Row="4" Grid.Column="3"  
                                    Value="{Binding BeginDateTime}" 
                                    Watermark="Дата/время начала" Height="23" Width="190"/>
            <StackPanel Grid.Row="5" Grid.Column="4" Orientation="Horizontal">
                <TextBlock VerticalAlignment="Top" Margin="5,0">
                    <Hyperlink Command="{Binding SetCurrentDateTimeBeginCommand}">Текущее время</Hyperlink>
                </TextBlock>
            </StackPanel>
        </Grid>

        <ContentControl Grid.Row="1" Content="{Binding ProtocolEditor}" VerticalAlignment="Stretch" HorizontalAlignment="Stretch"/>

        <views:RecordDocumentsView Grid.Row="2" DataContext="{Binding DocumentsViewer}" Margin="2"/>

        <Grid Grid.Row="3" Visibility="{Binding IsEditModeInCurrentProtocolEditor, Converter={x:Static converters:BoolToVisibilityConverter.Instance}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"/>
                <ColumnDefinition Width="auto"/>
                <ColumnDefinition Width="auto"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
            </Grid.RowDefinitions>
            <TextBlock Grid.Row="0" Grid.Column="0" Text="Время окончания услуги" VerticalAlignment="Center" Margin="2"/>
            <toolkit:DateTimePicker Grid.Row="0" Grid.Column="1"  Value="{Binding EndDateTime}" 
                                    HorizontalAlignment="Left" Watermark="Дата/время окончания" Height="23" Width="190"/>
            <StackPanel Grid.Row="0" Grid.Column="2" Orientation="Horizontal">
                <TextBlock VerticalAlignment="Center" HorizontalAlignment="Left" Margin="2">
                    <Hyperlink Command="{Binding SetCurrentDateTimeEndCommand}">Текущее время</Hyperlink>
                </TextBlock>
            </StackPanel>
        </Grid>

        <ContentControl Content="{Binding BusyMediator}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.RowSpan="4"/>
        <ContentControl Content="{Binding FailureMediator}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.RowSpan="4"/>
    </Grid>
</UserControl>
